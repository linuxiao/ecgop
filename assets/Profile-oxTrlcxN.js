import{_ as M,u as R,r as y,a as N,g as i,o as v,c as z,d as a,w as s,b as m,k as w,q as b,h as A,ah as J,C as O,E as c}from"./index-CYhqdMvL.js";const $={class:"profile-container"},h={class:"card-header"},D={class:"security-item"},L={class:"dialog-footer"},T={__name:"Profile",setup(H){const r=R(),f=y(!1),g=y(!1),o=N({username:r.userInfo.username||"",realName:r.userInfo.realName||"",avatar:r.userInfo.avatar||"",phone:r.userInfo.phone||"",email:r.userInfo.email||""}),k={realName:[{required:!0,message:"请输入姓名",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},d=N({oldPassword:"",newPassword:"",confirmPassword:""}),C={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(n,e,t)=>{e!==d.newPassword?t(new Error("两次输入的密码不一致")):t()},trigger:"blur"}]},I=()=>{f.value=!0},U=()=>{f.value=!1,Object.assign(o,{username:r.userInfo.username||"",realName:r.userInfo.realName||"",avatar:r.userInfo.avatar||"",phone:r.userInfo.phone||"",email:r.userInfo.email||""})},x=async()=>{try{await r.updateUserInfo(o),f.value=!1,c.success("保存成功")}catch{c.error("保存失败")}},E=()=>{g.value=!0,Object.assign(d,{oldPassword:"",newPassword:"",confirmPassword:""})},q=async()=>{try{await r.changePassword(d),g.value=!1,c.success("密码修改成功")}catch{c.error("密码修改失败")}},B=n=>{const e=n.type==="image/jpeg",t=n.type==="image/png",_=n.size/1024/1024<2;return!e&&!t?(c.error("头像只能是 JPG 或 PNG 格式!"),!1):_?!0:(c.error("头像大小不能超过 2MB!"),!1)},G=n=>{o.avatar=n.url};return(n,e)=>{const t=i("el-button"),_=i("el-avatar"),S=i("el-icon"),j=i("el-upload"),u=i("el-form-item"),p=i("el-input"),V=i("el-form"),P=i("el-card"),F=i("el-dialog");return v(),z("div",$,[a(P,{class:"profile-card"},{header:s(()=>[m("div",h,[e[10]||(e[10]=m("span",null,"个人信息",-1)),a(t,{type:"primary",onClick:I},{default:s(()=>e[9]||(e[9]=[w("编辑")])),_:1})])]),default:s(()=>[a(V,{ref:"formRef",model:o,rules:k,"label-width":"100px",class:"profile-form",disabled:!f.value},{default:s(()=>[a(u,{label:"头像",prop:"avatar"},{default:s(()=>[a(j,{class:"avatar-uploader",action:"/api/upload","show-file-list":!1,disabled:!f.value,"before-upload":B,"on-success":G},{default:s(()=>[o.avatar?(v(),b(_,{key:0,size:100,src:o.avatar},null,8,["src"])):(v(),b(S,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[a(A(J))]),_:1}))]),_:1},8,["disabled"])]),_:1}),a(u,{label:"用户���",prop:"username"},{default:s(()=>[a(p,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=l=>o.username=l),disabled:""},null,8,["modelValue"])]),_:1}),a(u,{label:"姓名",prop:"realName"},{default:s(()=>[a(p,{modelValue:o.realName,"onUpdate:modelValue":e[1]||(e[1]=l=>o.realName=l)},null,8,["modelValue"])]),_:1}),a(u,{label:"手机号",prop:"phone"},{default:s(()=>[a(p,{modelValue:o.phone,"onUpdate:modelValue":e[2]||(e[2]=l=>o.phone=l)},null,8,["modelValue"])]),_:1}),a(u,{label:"邮箱",prop:"email"},{default:s(()=>[a(p,{modelValue:o.email,"onUpdate:modelValue":e[3]||(e[3]=l=>o.email=l)},null,8,["modelValue"])]),_:1}),f.value?(v(),b(u,{key:0},{default:s(()=>[a(t,{type:"primary",onClick:x},{default:s(()=>e[11]||(e[11]=[w("保存")])),_:1}),a(t,{onClick:U},{default:s(()=>e[12]||(e[12]=[w("取消")])),_:1})]),_:1})):O("",!0)]),_:1},8,["model","disabled"])]),_:1}),a(P,{class:"security-card"},{header:s(()=>e[13]||(e[13]=[m("div",{class:"card-header"},[m("span",null,"安全设置")],-1)])),default:s(()=>[m("div",D,[e[15]||(e[15]=m("div",{class:"security-info"},[m("div",{class:"security-title"},"账户密码"),m("div",{class:"security-desc"},"建议定期更改密码，设置更安全的密码")],-1)),a(t,{link:"",type:"primary",onClick:E},{default:s(()=>e[14]||(e[14]=[w("修改")])),_:1})])]),_:1}),a(F,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=l=>g.value=l),title:"修改密码",width:"500px"},{footer:s(()=>[m("span",L,[a(t,{onClick:e[7]||(e[7]=l=>g.value=!1)},{default:s(()=>e[16]||(e[16]=[w("取消")])),_:1}),a(t,{type:"primary",onClick:q},{default:s(()=>e[17]||(e[17]=[w(" 确认 ")])),_:1})])]),default:s(()=>[a(V,{ref:"passwordFormRef",model:d,rules:C,"label-width":"100px"},{default:s(()=>[a(u,{label:"当前密码",prop:"oldPassword"},{default:s(()=>[a(p,{modelValue:d.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>d.oldPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"新密码",prop:"newPassword"},{default:s(()=>[a(p,{modelValue:d.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>d.newPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"确认新密码",prop:"confirmPassword"},{default:s(()=>[a(p,{modelValue:d.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>d.confirmPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Q=M(T,[["__scopeId","data-v-0f847582"]]);export{Q as default};
